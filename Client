import socket

# List of valid queries
queries = [
    "What is the average moisture inside my kitchen fridge in the past three hours?",
    "What is the average water consumption per cycle in my smart dishwasher?",
    "Which device consumed more electricity among my three IoT devices (two refrigerators and a dishwasher)?"
]

# Prompt for server IP and port
server_ip = input("Enter the server IP (use the EXTERNAL IP of the server VM): ")
port = int(input("Enter port (e.g., 12345): "))  # Must match the server's port

# Create a TCP socket
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Connect to the server
try:
    client_socket.connect((server_ip, port))
    print(f"Connected to {server_ip}:{port}")
except Exception as e:
    print(f"Failed to connect: {e}")
    exit()

# Display query options
print("\nWelcome to the Smart IoT Query System!")
print("You can ask one of the following questions:")
for i, query in enumerate(queries, 1):
    print(f"{i}. {query}")
print("Type 'exit' to quit.\n")

# Messaging loop
while True:
    message = input("Enter your query (or 'exit' to quit): ")
    if message.lower() == "exit":
        break

    if message in queries:
        client_socket.sendall(message.encode())
        data = client_socket.recv(1024)
        print(f"\nServer replied: {data.decode()}\n")
    else:
        print("\nSorry, this query cannot be processed. Please try one of the following:")
        for i, query in enumerate(queries, 1):
            print(f"{i}. {query}")
        print()

client_socket.close()
print("Connection closed.")
